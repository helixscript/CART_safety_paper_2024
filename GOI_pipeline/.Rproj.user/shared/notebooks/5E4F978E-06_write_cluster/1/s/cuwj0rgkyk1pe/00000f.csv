"0",""
"0",""
"0","annotate_scan_clusters <- function(scanned_ranges, tdn_sites, "
"0","                                   timepoint_sites, refGenes){"
"0","  scanned_ranges$n_sites_tdn <- scan_sites_count("
"0","    scanned_ranges, tdn_sites)"
"0","  scanned_ranges$n_sites_tp <- scan_sites_count("
"0","    scanned_ranges, timepoint_sites)"
"0","  scanned_ranges$sum_abund_tdn <- scan_sites_abundance("
"0","    scanned_ranges, tdn_sites)"
"0","  scanned_ranges$sum_abund_tp <- scan_sites_abundance("
"0","    scanned_ranges, timepoint_sites)"
"0","  scanned_ranges$n_patients_tdn <- scan_patients("
"0","    scanned_ranges, tdn_sites)"
"0","  scanned_ranges$n_patients_tp <- scan_patients("
"0","    scanned_ranges, timepoint_sites)"
"0","  scanned_ranges$genes_in_cluster <- scan_genes("
"0","    scanned_ranges, refGenes)"
"0","  scanned_ranges$in_gene_ort_tdn <- scan_orientation("
"0","    scanned_ranges, tdn_sites)"
"0","  scanned_ranges$in_gene_ort_tp <- scan_orientation("
"0","    scanned_ranges, timepoint_sites)"
"0","  scanned_ranges$ort_fisher_test <- scan_fisher_test_ort("
"0","    scanned_ranges$in_gene_ort_tdn, scanned_ranges$in_gene_ort_tp)"
"0","  scanned_ranges"
"0","}"
"0",""
"0","scan_sites_count <- function(clus_gr, sites){"
"0","  sapply(1:length(clus_gr), function(i){"
"0","    clus <- clus_gr[i]"
"0","    hits <- subjectHits(findOverlaps(clus, sites))"
"0","    length(unique(hits))"
"0","  })"
"0","}"
"0",""
"0","scan_sites_abundance <- function(clus_gr, sites){"
"0","  sapply(1:length(clus_gr), function(i){"
"0","    clus <- clus_gr[i]"
"0","    hits <- subjectHits(findOverlaps(clus, sites))"
"0","    sum(sites[hits]$estAbund)"
"0","  })"
"0","}"
"0","scan_patients <- function(clus_gr, sites){"
"0","  sapply(1:length(clus_gr), function(i){"
"0","    clus <- clus_gr[i]"
"0","    hits <- subjectHits(findOverlaps(clus, sites))"
"0","    length(unique(sites[hits]$patient))"
"0","  })"
"0","}"
"0",""
"0","scan_genes <- function(clus_gr, refGenes){"
"0","  sapply(1:length(clus_gr), function(i){"
"0","    clus <- clus_gr[i]"
"0","    hits <- subjectHits(findOverlaps(clus, refGenes))"
"0","    paste(unique(refGenes[hits]$name2), collapse = "", "")"
"0","  })"
"0","}"
"0",""
"0","scan_orientation <- function(clus_gr, sites){"
"0","  sapply(1:length(clus_gr), function(i){"
"0","    clus <- clus_gr[i]"
"0","    site_hits <- findOverlaps(clus, sites)"
"0","    site_ort <- strand(sites[subjectHits(site_hits)])"
"0","    gene_ort <- sites[subjectHits(site_hits)]$in_geneOrt"
"0","    if(length(sites[subjectHits(site_hits)]) > 0){"
"0","      df <- data.frame("
"0","        ""posid"" = generate_posid(sites[subjectHits(site_hits)]),"
"0","        ""site_ort"" = as.character(site_ort),"
"0","        ""gene_ort"" = as.character(gene_ort),"
"0","        ""patient"" = sites[subjectHits(site_hits)]$patient,"
"0","        stringsAsFactors = FALSE"
"0","      )"
"0","      df <- distinct(df)"
"0","      df$same_orientation <- df$site_ort == df$gene_ort"
"0","      score <- paste0("
"0","        ""T"", length(grep(""TRUE"", df$same_orientation)), "":"","
"0","        ""F"", length(grep(""FALSE"", df$same_orientation)), "":"","
"0","        ""N"", length(grep(""TRUE"", is.na(df$same_orientation)))"
"0","      )"
"0","    }else{"
"0","      score <- ""T0:F0:N0"""
"0","    }"
"0","    score"
"0","  })"
"0","}"
"0",""
"0","scan_fisher_test_ort <- function(score1, score2){"
"0","  sapply(1:length(score1), function(i){"
"0","    grp1 <- unlist(strsplit(score1[i], "":""))"
"0","    grp2 <- unlist(strsplit(score2[i], "":""))"
"0","    x <- matrix(c("
"0","      as.integer(substr(grp1[1], 2, 3)),"
"0","      as.integer(substr(grp1[2], 2, 3)),"
"0","      as.integer(substr(grp2[1], 2, 3)),"
"0","      as.integer(substr(grp2[2], 2, 3))),"
"0","      ncol = 2"
"0","    )"
"0","    fisher.test(x)$p.value"
"0","  })"
"0","}"
"0",""
"0",""
